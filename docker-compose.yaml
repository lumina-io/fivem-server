services:
  fivem:
    image: ghcr.io/lumina-io/fivem-server:latest
    container_name: "fivem-server"
    restart: "${RESTART_POLICY:-no}"
    network_mode: "host"
    tty: true
    build:
      context: .
      dockerfile: Dockerfile
      args:
        USER_ID: ${USER_ID:-0}
        GROUP_ID: ${GROUP_ID:-0}
    volumes:
      - ./local/txData:/app/fivem/txData
      - ./local/logs:/app/fivem/logs
    depends_on:
      mariadb:
        condition: service_healthy
    user: "${USER_ID:-0}:${GROUP_ID:-0}"
    env_file:
      - server-config.env
    environment:
      TZ: "Asia/Tokyo"
      # !!!
      # IF YOU WANT MOUNT VOLUMES,
      # UID/GID MUST BE Provide!!! (for directory / files permission)
      # !!!
      UID: "${USER_ID:-0}"
      GID: "${GROUP_ID:-0}"

  mariadb:
    image: mariadb:${MARIADB_VERSION:-lts}
    container_name: "fivem-mariadb"
    restart: "${RESTART_POLICY:-no}"
    network_mode: "host"
    command: ["--port", "${MARIADB_PORT}"]
    user: "${USER_ID:-0}:${GROUP_ID:-0}"
    volumes:
      - ./local/mysql:/var/lib/mysql
    env_file:
      - server-config.env
    environment:
      TZ: "Asia/Tokyo"
      # !!!
      # IF YOU WANT MOUNT VOLUMES,
      # UID/GID MUST BE Provide!!! (for directory / files permission)
      # !!!
      UID: "${USER_ID}"
      GID: "${GROUP_ID}"
    healthcheck:
      test: ["CMD", "mariadb-admin", "ping", "-h", "localhost", "-u", "root", "-p${MARIADB_ROOT_PASSWORD}"]
      interval: "30s"
      timeout: "5s"
      retries: 5
      start_period: "10s"
    # Copy-pasted from https://github.com/docker-library/mariadb/issues/94
    #healthcheck:
    #  test: ["CMD", "mysqladmin", "ping", "--silent",  "--user", "${MARIADB_USER}", "--password", "${MARIADB_PASSWORD}"]
